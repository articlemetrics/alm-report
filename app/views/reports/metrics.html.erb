
<div class="content wrapper">

  <%= render "reports_nav" %>

  <div class="metrics-left-content">
    <% if @show_metrics_data %>
      <p class="albert-light-normal metrics-article-count"><%= @start_result %>-<%= @end_result %> of <%= @total_found %> articles</p>

      <% @dois.each do |doi| %>
      <div class="visualizations-list">
        <span class="list-numbers"><%= doi.display_index %></span>
        <h3 class="metrics-article-title"><%= doi.solr["title"] %></h3>
        <% if !doi.solr["author_display"].nil? %>
        <p class="metrics-para">
          <% doi.solr["author_display"].each_with_index do |author, idx| %>
            <%= author %><% if idx < doi.solr["author_display"].length - 1 %>,<% end %>
          <% end %>
        </p>
        <% end %>
        <p class="metrics-description">
          Research Article
          <span class="vertical-separator">|</span>
          published <%= doi.solr["publication_date"].strftime("%d %b %Y") %>
          <span class="vertical-separator">|</span>
          <%= doi.solr["cross_published_journal_name"][0] %>
        </p>
        <p class="metrics-description"><%= doi.doi %></p>

        <% if doi.alm.nil? %>
          <div class="metrics-no-data-para">This article data isn't available.  Please check back later.</div>
        <% else %>
          <a class="show-all-alms-link">Show all ALMs<span class="show-all-alms-link"></span></a>
          <div class="metrics-table-content">
            <div class="metric-row-content">
                <table class="metrics-table <%= "metric-without-data" if !doi.alm[:usage_data_present] %>" >
                  <caption>Usage</caption>
                  <%= render "alm_stat", :stat => doi.alm[:plos_html], :label => "PLOS views" %>
                  <%= render "alm_stat", :stat => doi.alm[:plos_pdf], :label => "PLOS PDF downloads" %>
                  <%= render "alm_stat", :stat => doi.alm[:plos_xml], :label => "PLOS XML downloads" %>
                  <%= render "alm_stat", :stat => doi.alm[:pmc_views], :label => "PMC views" %>
                  <%= render "alm_stat", :stat => doi.alm[:pmc_pdf], :label => "PMC PDF downloads" %>
                  <%= render "alm_stat", :stat => doi.alm[:total_usage], :label => "Total usage" %>
                </table>

                <table class="metrics-table <%= "metric-without-data" if !doi.alm[:social_network_data_present] %>">
                  <caption>Social Network</caption>
                  <%= render "alm_stat", :stat => doi.alm[:citeulike], :label => "CiteULike" %>
                  <%= render "alm_stat", :stat => doi.alm[:connotea], :label => "Connotea" %>
                  <%= render "alm_stat", :stat => doi.alm[:mendeley], :label => "Mendeley" %>
                  <%= render "alm_stat", :stat => doi.alm[:twitter], :label => "Twitter" %>
                  <%= render "alm_stat", :stat => doi.alm[:facebook], :label => "Facebook" %>
                </table>
            </div>
            <div class="metric-row-content">
                <table class="metrics-table <%= "metric-without-data" if !doi.alm[:citation_data_present] %>">
                  <caption>Citation</caption>
                  <%= render "alm_stat", :stat =>doi.alm[:pmc_citations], :label => "PubMed Central" %>
                  <%= render "alm_stat", :stat => doi.alm[:crossref_citations], :label => "CrossRef" %>
                  <%= render "alm_stat", :stat => doi.alm[:scopus_citations], :label => "Scopus" %>
                  <%# TODO: web of science.  It is in the mockups, but not in ALM today.  %>
                </table>

                <table class="metrics-table <%= "metric-without-data" if !doi.alm[:blogs_data_present] %>">
                  <caption>Blogs &amp; Media</caption>
                  <%= render "alm_stat", :stat => doi.alm[:nature], :label => "Nature Blogs" %>
                  <%= render "alm_stat", :stat => doi.alm[:research_blogging], :label => "Research Blogging" %>
                  <%# TODO: trackbacks.  Not in ALM--get from ambra DB?  %>
                  <%= render "alm_stat", :stat => doi.alm[:wikipedia], :label => "Wikipedia" %>
                </table>
            </div>
            <div class="metric-row-content">
              <%# TODO: get these from ambra DB  %>
      <!--
              <table class="metrics-table  plos-table">
                <caption>PLOS Community</caption>
                <tr>
                  <td class="list-names">Comments</td>
                  <td class="metrics-list-value">2</td>
                </tr>
                <tr>
                  <td class="list-names">Notes</td>
                  <td class="metrics-list-value">5</td>
                </tr>
              </table>
      -->
            </div>
          </div>
        <% end %>

      </div>
      <% end %>
    <% end %>

  </div>

  <%= render "report_download" %>
  
  <% if @show_metrics_data %>
  <%= render "pager", :results_per_page => 5 %>
  <% end %>

</div>
